<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Manhattan Road Closures</title>
    <style>
        body { font-family: sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        #header {
            background-color: #333;
            color: white;
            padding: 10px 20px;
            text-align: center;
        }
        #header .subtitle {
            margin: 5px 0;
            font-size: 14px;
            color: #ccc;
        }
        #header .subtitle a {
            color: #ccc;
            text-decoration: none;
        }
        #header .subtitle a:hover {
            text-decoration: underline;
        }
        #map { height: 100%; width: 100%; }
        .leaflet-popup-content-wrapper {
            border-radius: 5px;
        }
        .leaflet-popup-content {
            font-size: 14px;
        }
        .popup-title {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }
        .leaflet-tooltip {
            background: rgba(0, 0, 0, 0.9);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 13px;
            line-height: 1.4;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        .leaflet-tooltip-top:before {
            border-top-color: rgba(0, 0, 0, 0.9);
        }
        .leaflet-tooltip-bottom:before {
            border-bottom-color: rgba(0, 0, 0, 0.9);
        }
        .leaflet-tooltip-left:before {
            border-left-color: rgba(0, 0, 0, 0.9);
        }
        .leaflet-tooltip-right:before {
            border-right-color: rgba(0, 0, 0, 0.9);
        }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
</head>
<body>

    <div id="header">
        <h1>Manhattan Road Closures</h1>
        <p id="date-range" class="subtitle"></p>
        <p class="subtitle">Data source: <a href="https://www.nyc.gov/html/dot/html/motorist/weektraf.shtml#manhattan" target="_blank">NYC DOT Weekly Traffic Advisory</a></p>
    </div>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

    <script>
        // Calculate dynamic date range
        function getWeekRange() {
            const today = new Date();
            const currentDay = today.getDay(); // 0 = Sunday, 1 = Monday, ..., 6 = Saturday
            
            // Find the Saturday before or on current date
            const daysToSaturday = currentDay === 6 ? 0 : (currentDay + 1) % 7;
            const saturday = new Date(today);
            saturday.setDate(today.getDate() - daysToSaturday);
            
            // Find the Friday after Saturday
            const friday = new Date(saturday);
            friday.setDate(saturday.getDate() + 6);
            
            return { saturday, friday };
        }

        function formatDate(date) {
            const options = { 
                weekday: 'long', 
                month: 'long', 
                day: 'numeric', 
                year: 'numeric' 
            };
            return date.toLocaleDateString('en-US', options);
        }

        function formatDateShort(date) {
            const options = { 
                month: 'short', 
                day: 'numeric', 
                year: 'numeric' 
            };
            return date.toLocaleDateString('en-US', options);
        }

        // Set dynamic dates
        const { saturday, friday } = getWeekRange();
        const dateRangeText = `${formatDate(saturday)} to ${formatDate(friday)}`;
        document.getElementById('date-range').textContent = dateRangeText;

        // Embedded JSON data
        const closuresData = {
  "events": [
    {
      "closures": [
        {
          "streets": [
            {
              "endLocation": "Centre Street & Worth Street, New York, NY",
              "startLocation": "Centre Street & Brooklyn Bridge Exit, New York, NY",
              "startLat": 40.7124898,
              "startLng": -74.00481289999999,
              "endLat": 40.7151549,
              "endLng": -74.0020984
            },
            {
              "endLocation": "Lafayette Street & 4th Avenue, New York, NY",
              "startLocation": "Lafayette Street & Worth Street, New York, NY",
              "startLat": 40.7156041,
              "startLng": -74.0030377,
              "endLat": 40.730842,
              "endLng": -73.99049629999999
            },
            {
              "endLocation": "4th Avenue & East 14th Street, New York, NY",
              "startLocation": "4th Avenue & East 9th Street, New York, NY",
              "startLat": 40.6703448,
              "startLng": -73.98862009999999,
              "endLat": 40.7344188,
              "endLng": -73.9898924
            },
            {
              "endLocation": "Union Square East & East 17th Street, New York, NY",
              "startLocation": "Union Square East & East 14th Street, New York, NY",
              "startLat": 40.7347921,
              "startLng": -73.990752,
              "endLat": 40.73653669999999,
              "endLng": -73.9889707
            },
            {
              "endLocation": "Park Avenue South & East 32nd Street, New York, NY",
              "startLocation": "Park Avenue South & East 17th Street, New York, NY",
              "startLat": 40.73653669999999,
              "startLng": -73.9889707,
              "endLat": 40.7457705,
              "endLng": -73.9822125
            },
            {
              "endLocation": "Park Avenue & East 110th Street, New York, NY",
              "startLocation": "Park Avenue & East 32nd Street, New York, NY",
              "startLat": 40.7457705,
              "startLng": -73.9822125,
              "endLat": 40.7955314,
              "endLng": -73.94619229999999
            },
            {
              "endLocation": "110th Street & Broadway, New York, NY",
              "startLocation": "110th Street & Duke Ellington Circle, New York, NY",
              "startLat": 40.7970797,
              "startLng": -73.949692,
              "endLat": 40.8041823,
              "endLng": -73.9665744
            },
            {
              "endLocation": "Broadway & Dyckman Street, New York, NY",
              "startLocation": "Broadway & West 110th Street, New York, NY",
              "startLat": 40.8041823,
              "startLng": -73.9665744,
              "endLat": 40.865521,
              "endLng": -73.9272625
            },
            {
              "endLocation": "Kenmare Street & Cleveland Place, New York, NY",
              "startLocation": "Kenmare Street & Lafayette Street, New York, NY",
              "startLat": 40.7215971,
              "startLng": -73.9977938,
              "endLat": 40.7214604,
              "endLng": -73.9974
            },
            {
              "endLocation": "Cleveland Place & Lafayette Street, New York, NY",
              "startLocation": "Cleveland Place & Kenmare Street, New York, NY",
              "startLat": 40.7214604,
              "startLng": -73.9974,
              "endLat": 40.7222912,
              "endLng": -73.99708679999999
            },
            {
              "endLocation": "Duke Ellington Circle, New York, NY",
              "startLocation": "Duke Ellington Circle, New York, NY",
              "startLat": 40.7971304,
              "startLng": -73.9491477,
              "endLat": 40.7971304,
              "endLng": -73.9491477
            },
            {
              "endLocation": "Frederick Douglass Circle, New York, NY",
              "startLocation": "Frederick Douglass Circle, New York, NY",
              "startLat": 40.8004106,
              "startLng": -73.9583361,
              "endLat": 40.8004106,
              "endLng": -73.9583361
            }
          ],
          "type": "Route"
        },
        {
          "streets": [
            {
              "endLocation": "Centre Street & Worth Street, New York, NY",
              "startLocation": "Centre Street & Duane Street, New York, NY",
              "startLat": 40.7141536,
              "startLng": -74.0034194,
              "endLat": 40.7151549,
              "endLng": -74.0020984
            },
            {
              "endLocation": "Astor Place & Lafayette Street, New York, NY",
              "startLocation": "Astor Place & Broadway, New York, NY",
              "startLat": 40.7301271,
              "startLng": -73.9928111,
              "endLat": 40.7298569,
              "endLng": -73.99142189999999
            },
            {
              "endLocation": "4th Avenue & East 8th Street, New York, NY",
              "startLocation": "4th Avenue & East 9th Street, New York, NY",
              "startLat": 40.73056570000001,
              "startLng": -73.99049169999999,
              "endLat": 40.7298824,
              "endLng": -73.99074089999999
            },
            {
              "endLocation": "East 26th Street & Lexington Avenue, New York, NY",
              "startLocation": "East 26th Street & Madison Avenue, New York, NY",
              "startLat": 40.7427776,
              "startLng": -73.9865801,
              "endLat": 40.7414162,
              "endLng": -73.9833685
            },
            {
              "endLocation": "East 27th Street & Lexington Avenue, New York, NY",
              "startLocation": "East 27th Street & Madison Avenue, New York, NY",
              "startLat": 40.7433803,
              "startLng": -73.9861384,
              "endLat": 40.7420369,
              "endLng": -73.9829123
            },
            {
              "endLocation": "Park Avenue & East 41st Street, New York, NY",
              "startLocation": "Park Avenue & East 40th Street, New York, NY",
              "startLat": 40.7508637,
              "startLng": -73.9786513,
              "endLat": 40.7515249,
              "endLng": -73.9782889
            },
            {
              "endLocation": "East 52nd Street & Lexington Avenue, New York, NY",
              "startLocation": "East 52nd Street & Madison Avenue, New York, NY",
              "startLat": 40.7591144,
              "startLng": -73.9747003,
              "endLat": 40.757765,
              "endLng": -73.9714466
            },
            {
              "endLocation": "East 53rd Street & Lexington Avenue, New York, NY",
              "startLocation": "East 53rd Street & Park Avenue, New York, NY",
              "startLat": 40.7590077,
              "startLng": -73.9725204,
              "endLat": 40.7583783,
              "endLng": -73.9710023
            },
            {
              "endLocation": "East 109th Street & Lexington Avenue, New York, NY",
              "startLocation": "East 109th Street & Park Avenue, New York, NY",
              "startLat": 40.7949317,
              "startLng": -73.94662989999999,
              "endLat": 40.79418820000001,
              "endLng": -73.9448719
            },
            {
              "endLocation": "Adam Clayton Powell Jr Boulevard & West 125th Street, New York, NY",
              "startLocation": "Adam Clayton Powell Jr Boulevard & Central Park North, New York, NY",
              "startLat": 40.7994033,
              "startLng": -73.9552051,
              "endLat": 40.8089427,
              "endLng": -73.9482415
            },
            {
              "endLocation": "West 112th Street & Amsterdam Avenue, New York, NY",
              "startLocation": "West 112th Street & Broadway, New York, NY",
              "startLat": 40.8054199,
              "startLng": -73.9656699,
              "endLat": 40.80426,
              "endLng": -73.96291579999999
            },
            {
              "endLocation": "Broadway & West 126th Street, New York, NY",
              "startLocation": "Broadway & West 125th Street, New York, NY",
              "startLat": 40.8155981,
              "startLng": -73.9581984,
              "endLat": 40.8162867,
              "endLng": -73.95770329999999
            },
            {
              "endLocation": "West 144th Street & Amsterdam Avenue, New York, NY",
              "startLocation": "West 144th Street & Broadway, New York, NY"
            },
            {
              "endLocation": "Broadway & West 168th Street, New York, NY",
              "startLocation": "Broadway & West 166th Street, New York, NY"
            },
            {
              "endLocation": "West 175th Street & Wadsworth Avenue, New York, NY",
              "startLocation": "West 175th Street & Broadway, New York, NY"
            },
            {
              "endLocation": "West 180th Street & Wadsworth Avenue, New York, NY",
              "startLocation": "West 180th Street & Broadway, New York, NY"
            },
            {
              "endLocation": "Dyckman Street & Henshaw Street, New York, NY",
              "startLocation": "Dyckman Street & Broadway, New York, NY"
            },
            {
              "endLocation": "Broadway & Arden Street, New York, NY",
              "startLocation": "Broadway & Dyckman Street, New York, NY"
            },
            {
              "endLocation": "Thayer Street & Sherman Avenue, New York, NY",
              "startLocation": "Thayer Street & Broadway, New York, NY"
            }
          ],
          "type": "Miscellaneous"
        },
        {
          "streets": [
            {
              "endLocation": "Cooper Square & 7th Street, New York, NY",
              "startLocation": "Cooper Square & Astor Place, New York, NY"
            },
            {
              "endLocation": "Madison Avenue & 23rd Street, New York, NY",
              "startLocation": "Madison Avenue & 27th Street, New York, NY"
            },
            {
              "endLocation": "41st Street & Madison Avenue, New York, NY",
              "startLocation": "41st Street & Park Avenue, New York, NY"
            },
            {
              "endLocation": "West 124th Street & Malcom X Boulevard, New York, NY",
              "startLocation": "West 124th Street & Adam Clayton Powell Jr Boulevard, New York, NY"
            },
            {
              "endLocation": "Riverside Drive & Broadway, New York, NY",
              "startLocation": "Riverside Drive, New York, NY"
            }
          ],
          "type": "Miscellaneous"
        }
      ],
      "eventDate": "2025-08-09",
      "eventName": "Summer Streets – Week 2"
    },
    {
      "closures": [
        {
          "streets": [
            {
              "endLocation": "Edgecomb Avenue & 136th Street, New York, NY",
              "startLocation": "Edgecomb Avenue & 135th Street, New York, NY"
            },
            {
              "endLocation": "136th Street & Frederick Douglass Boulevard, New York, NY",
              "startLocation": "136th Street & St. Nicholas Avenue, New York, NY"
            }
          ],
          "type": "Formation"
        },
        {
          "streets": [
            {
              "endLocation": "Edgecomb Avenue & 140th Street, New York, NY",
              "startLocation": "Edgecomb Avenue & 136th Street, New York, NY"
            },
            {
              "endLocation": "139th Street & St. Nicholas Avenue, New York, NY",
              "startLocation": "139th Street & Edgecomb Avenue, New York, NY"
            },
            {
              "endLocation": "St. Nicholas Avenue & 155th Street, New York, NY",
              "startLocation": "St. Nicholas Avenue & 127th Street, New York, NY"
            },
            {
              "endLocation": "141st Street & Convent Avenue, New York, NY",
              "startLocation": "141st Street & St. Nicholas Avenue, New York, NY"
            },
            {
              "endLocation": "Convent Avenue & 135th Street, New York, NY",
              "startLocation": "Convent Avenue & 141st Street, New York, NY"
            },
            {
              "endLocation": "135th Street & Convent Avenue, New York, NY",
              "startLocation": "135th Street & St. Nicholas Terrace, New York, NY"
            },
            {
              "endLocation": "127th Street & St. Nicholas Avenue, New York, NY",
              "startLocation": "127th Street & St. Nicholas Terrace, New York, NY"
            },
            {
              "endLocation": "St. Nicholas Terrace & 127th Street, New York, NY",
              "startLocation": "St. Nicholas Terrace & 135th Street, New York, NY"
            }
          ],
          "type": "Route"
        },
        {
          "streets": [
            {
              "endLocation": "134th Street & Frederick Douglass Boulevard, New York, NY",
              "startLocation": "134th Street & St. Nicholas Avenue, New York, NY"
            },
            {
              "endLocation": "135th Street & Frederick Douglass Boulevard, New York, NY",
              "startLocation": "135th Street & St. Nicholas Avenue, New York, NY"
            },
            {
              "endLocation": "137th Street & Frederick Douglass Boulevard, New York, NY",
              "startLocation": "137th Street & Edgecomb Avenue, New York, NY"
            },
            {
              "endLocation": "138th Street & Frederick Douglass Boulevard, New York, NY",
              "startLocation": "138th Street & Edgecomb Avenue, New York, NY"
            }
          ],
          "type": "Miscellaneous"
        }
      ],
      "eventDate": "2025-08-09",
      "eventName": "Percy Sutton Harlem 5K"
    },
    {
      "closures": [
        {
          "streets": [
            {
              "endLocation": "6th Avenue & 56th Street, New York, NY",
              "startLocation": "6th Avenue & 42nd Street, New York, NY"
            }
          ],
          "type": "Miscellaneous"
        }
      ],
      "eventDate": "2025-08-09",
      "eventName": "The Great 6th Avenue Festival"
    },
    {
      "closures": [
        {
          "streets": [
            {
              "endLocation": "Riverside Drive West & West 120th Street, New York, NY",
              "startLocation": "Riverside Drive West & Tiemann Place, New York, NY"
            },
            {
              "endLocation": "Riverside Drive East & Tiemann Place, New York, NY",
              "startLocation": "Riverside Drive East & West 120th Street, New York, NY"
            },
            {
              "endLocation": "Riverside Drive & 122nd Street, New York, NY",
              "startLocation": "Riverside Drive & 120th Street, New York, NY"
            },
            {
              "endLocation": "West 122nd Street & Claremont Avenue, New York, NY",
              "startLocation": "West 122nd Street & Riverside Drive, New York, NY"
            }
          ],
          "type": "Miscellaneous"
        }
      ],
      "eventDate": "2025-08-10",
      "eventName": "A Great Day in Harlem Festival"
    },
    {
      "closures": [
        {
          "streets": [
            {
              "endLocation": "6th Avenue & 38th Street, New York, NY",
              "startLocation": "6th Avenue & 37th Street, New York, NY"
            },
            {
              "endLocation": "36th Street & 5th Avenue, New York, NY",
              "startLocation": "36th Street & Broadway, New York, NY"
            },
            {
              "endLocation": "38th Street & 7th Avenue, New York, NY",
              "startLocation": "38th Street & 5th Avenue, New York, NY"
            },
            {
              "endLocation": "37th Street & 7th Avenue, New York, NY",
              "startLocation": "37th Street & 5th Avenue, New York, NY"
            }
          ],
          "type": "Formation"
        },
        {
          "streets": [
            {
              "endLocation": "6th Avenue & 55th Street, New York, NY",
              "startLocation": "6th Avenue & 36th Street, New York, NY"
            }
          ],
          "type": "Route"
        },
        {
          "streets": [
            {
              "endLocation": "55th Street & 7th Avenue, New York, NY",
              "startLocation": "55th Street & 6th Avenue, New York, NY"
            }
          ],
          "type": "Dispersal"
        }
      ],
      "eventDate": "2025-08-10",
      "eventName": "Dominican Day Parade"
    }
  ]
};

        // 1. Initialize the map
        const map = L.map('map').setView([40.758896, -73.985130], 14);

        // 2. Add a tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        // 3. Process the closures data and add polylines to the map
        closuresData.events.forEach(event => {
            event.closures.forEach(closure => {
                closure.streets.forEach(street => {
                    // Create the polyline using the start and end coordinates
                    const polyline = L.polyline([
                        [street.startLat, street.startLng],
                        [street.endLat, street.endLng]
                    ], {
                        color: '#ff4444',
                        weight: 6,
                        opacity: 0.9,
                        lineCap: 'round',
                        lineJoin: 'round',
                        dashArray: '10, 5'
                    }).addTo(map);

                    // Create the HTML content for the tooltip
                    const tooltipContent = `
                        <div style="font-weight: bold; margin-bottom: 4px;">${event.eventName}</div>
                        <div style="margin-bottom: 2px;"><strong>Date:</strong> ${event.eventDate}</div>
                        <div style="margin-bottom: 2px;"><strong>From:</strong> ${street.startLocation}</div>
                        <div style="margin-bottom: 2px;"><strong>To:</strong> ${street.endLocation}</div>
                    `;

                    polyline.bindTooltip(tooltipContent, {
                        permanent: false,
                        direction: 'top',
                        offset: [0, -10],
                        opacity: 1
                    });

                    // Add hover effects
                    polyline.on('mouseover', function(e) {
                        this.setStyle({
                            weight: 8,
                            opacity: 1,
                            color: '#ff2222'
                        });
                    });

                    polyline.on('mouseout', function(e) {
                        this.setStyle({
                            weight: 6,
                            opacity: 0.9,
                            color: '#ff4444'
                        });
                    });
                });
            });
        });

        // 4. Fit the map to show all closures
        if (closuresData.events.length > 0) {
            const bounds = L.latLngBounds();
            closuresData.events.forEach(event => {
                event.closures.forEach(closure => {
                    closure.streets.forEach(street => {
                        bounds.extend([street.startLat, street.startLng]);
                        bounds.extend([street.endLat, street.endLng]);
                    });
                });
            });
            map.fitBounds(bounds, { padding: [20, 20] });
        }

    </script>

</body>
</html>