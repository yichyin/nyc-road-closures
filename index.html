<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Manhattan Road Closures</title>
    <style>
        body { font-family: sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        #header {
            background-color: #333;
            color: white;
            padding: 10px 20px;
            text-align: center;
        }
        #header .subtitle {
            margin: 5px 0;
            font-size: 14px;
            color: #ccc;
        }
        #header .subtitle a {
            color: #ccc;
            text-decoration: none;
        }
        #header .subtitle a:hover {
            text-decoration: underline;
        }
        #map { height: 100%; width: 100%; }
        .leaflet-popup-content-wrapper {
            border-radius: 5px;
        }
        .leaflet-popup-content {
            font-size: 14px;
        }
        .popup-title {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
</head>
<body>

    <div id="header">
        <h1>Manhattan Road Closures</h1>
        <p id="date-range" class="subtitle"></p>
        <p class="subtitle">Data source: <a href="https://www.nyc.gov/html/dot/html/motorist/weektraf.shtml#manhattan" target="_blank">NYC DOT Weekly Traffic Advisory</a></p>
    </div>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

    <script>
        // Calculate dynamic date range
        function getWeekRange() {
            const today = new Date();
            const currentDay = today.getDay(); // 0 = Sunday, 1 = Monday, ..., 6 = Saturday
            
            // Find the Saturday before or on current date
            const daysToSaturday = currentDay === 6 ? 0 : (currentDay + 1) % 7;
            const saturday = new Date(today);
            saturday.setDate(today.getDate() - daysToSaturday);
            
            // Find the Friday after Saturday
            const friday = new Date(saturday);
            friday.setDate(saturday.getDate() + 6);
            
            return { saturday, friday };
        }

        function formatDate(date) {
            const options = { 
                weekday: 'long', 
                month: 'long', 
                day: 'numeric', 
                year: 'numeric' 
            };
            return date.toLocaleDateString('en-US', options);
        }

        function formatDateShort(date) {
            const options = { 
                month: 'short', 
                day: 'numeric', 
                year: 'numeric' 
            };
            return date.toLocaleDateString('en-US', options);
        }

        // Set dynamic dates
        const { saturday, friday } = getWeekRange();
        const dateRangeText = `${formatDate(saturday)} to ${formatDate(friday)}`;
        document.getElementById('date-range').textContent = dateRangeText;

        // Embedded JSON data
        const closuresData = {
            "events": [
                {
                    "closures": [
                        {
                            "streets": [
                                {
                                    "endLocation": "3rd Avenue & 6th Street, New York, NY",
                                    "startLocation": "3rd Avenue & 14th Street, New York, NY",
                                    "startLat": 40.7332854,
                                    "startLng": -73.9871982,
                                    "endLat": 40.7283704,
                                    "endLng": -73.99084789999999
                                }
                            ],
                            "type": "Miscellaneous"
                        }
                    ],
                    "eventDate": "2025-07-05",
                    "eventName": "3rd Avenue Cooper Square Fair"
                },
                {
                    "closures": [
                        {
                            "streets": [
                                {
                                    "endLocation": "Lexington Avenue & 51st Street, New York, NY",
                                    "startLocation": "Lexington Avenue & 42nd Street, New York, NY",
                                    "startLat": 40.7514508,
                                    "startLng": -73.97604869999999,
                                    "endLat": 40.75713,
                                    "endLng": -73.9719089
                                }
                            ],
                            "type": "Miscellaneous"
                        }
                    ],
                    "eventDate": "2025-07-06",
                    "eventName": "Lexington Avenue Fair"
                }
            ]
        };

        // 1. Initialize the map
        const map = L.map('map').setView([40.758896, -73.985130], 14);

        // 2. Add a tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);

        // 3. Process the closures data and add polylines to the map
        closuresData.events.forEach(event => {
            event.closures.forEach(closure => {
                closure.streets.forEach(street => {
                    // Create the polyline using the start and end coordinates
                    const polyline = L.polyline([
                        [street.startLat, street.startLng],
                        [street.endLat, street.endLng]
                    ], {
                        color: 'red',
                        weight: 5,
                        opacity: 0.8
                    }).addTo(map);

                    // Create the HTML content for the popup
                    const popupContent = `
                        <div class="popup-title">${event.eventName}</div>
                        <b>From:</b> ${street.startLocation}<br>
                        <b>To:</b> ${street.endLocation}<br>
                        <b>Date:</b> ${event.eventDate}<br>
                        <b>Type:</b> ${closure.type}
                    `;

                    polyline.bindPopup(popupContent);
                });
            });
        });

        // 4. Fit the map to show all closures
        if (closuresData.events.length > 0) {
            const bounds = L.latLngBounds();
            closuresData.events.forEach(event => {
                event.closures.forEach(closure => {
                    closure.streets.forEach(street => {
                        bounds.extend([street.startLat, street.startLng]);
                        bounds.extend([street.endLat, street.endLng]);
                    });
                });
            });
            map.fitBounds(bounds, { padding: [20, 20] });
        }

    </script>

</body>
</html>