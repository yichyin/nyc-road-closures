<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Manhattan Road Closures</title>
    <style>
        body { font-family: sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        #header {
            background-color: #333;
            color: white;
            padding: 10px 20px;
            text-align: center;
        }
        #header .subtitle {
            margin: 5px 0;
            font-size: 14px;
            color: #ccc;
        }
        #header .subtitle a {
            color: #ccc;
            text-decoration: none;
        }
        #header .subtitle a:hover {
            text-decoration: underline;
        }
        #map { height: 100%; width: 100%; }
        .leaflet-popup-content-wrapper {
            border-radius: 5px;
        }
        .leaflet-popup-content {
            font-size: 14px;
        }
        .popup-title {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }
        .leaflet-tooltip {
            background: rgba(0, 0, 0, 0.9);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 13px;
            line-height: 1.4;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        .leaflet-tooltip-top:before {
            border-top-color: rgba(0, 0, 0, 0.9);
        }
        .leaflet-tooltip-bottom:before {
            border-bottom-color: rgba(0, 0, 0, 0.9);
        }
        .leaflet-tooltip-left:before {
            border-left-color: rgba(0, 0, 0, 0.9);
        }
        .leaflet-tooltip-right:before {
            border-right-color: rgba(0, 0, 0, 0.9);
        }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
</head>
<body>

    <div id="header">
        <h1>Manhattan Road Closures</h1>
        <p id="date-range" class="subtitle"></p>
        <p class="subtitle">Data source: <a href="https://www.nyc.gov/html/dot/html/motorist/weektraf.shtml#manhattan" target="_blank">NYC DOT Weekly Traffic Advisory</a></p>
    </div>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

    <script>
        // Calculate dynamic date range
        function getWeekRange() {
            const today = new Date();
            const currentDay = today.getDay(); // 0 = Sunday, 1 = Monday, ..., 6 = Saturday
            
            // Find the Saturday before or on current date
            const daysToSaturday = currentDay === 6 ? 0 : (currentDay + 1) % 7;
            const saturday = new Date(today);
            saturday.setDate(today.getDate() - daysToSaturday);
            
            // Find the Friday after Saturday
            const friday = new Date(saturday);
            friday.setDate(saturday.getDate() + 6);
            
            return { saturday, friday };
        }

        function formatDate(date) {
            const options = { 
                weekday: 'long', 
                month: 'long', 
                day: 'numeric', 
                year: 'numeric' 
            };
            return date.toLocaleDateString('en-US', options);
        }

        function formatDateShort(date) {
            const options = { 
                month: 'short', 
                day: 'numeric', 
                year: 'numeric' 
            };
            return date.toLocaleDateString('en-US', options);
        }

        // Set dynamic dates
        const { saturday, friday } = getWeekRange();
        const dateRangeText = `${formatDate(saturday)} to ${formatDate(friday)}`;
        document.getElementById('date-range').textContent = dateRangeText;

        // Embedded JSON data
        const closuresData = {
  "events": [
    {
      "eventName": "Times Square Expo Fair",
      "eventDate": "2025-08-23",
      "closures": [
        {
          "type": "Miscellaneous",
          "streets": [
            {
              "startLocation": "7th Avenue & 47th Street, New York, NY",
              "endLocation": "7th Avenue & 57th Street, New York, NY",
              "startLat": 40.7592474,
              "startLng": -73.98465370000001,
              "endLat": 40.7655344,
              "endLng": -73.9800278
            }
          ]
        }
      ]
    },
    {
      "eventName": "Broadway Festival",
      "eventDate": "2025-08-23",
      "closures": [
        {
          "type": "Miscellaneous",
          "streets": [
            {
              "startLocation": "Broadway & Waverly Place, New York, NY",
              "endLocation": "Broadway & 14th Street, New York, NY",
              "startLat": 40.7295908,
              "startLng": -73.9932698,
              "endLat": 40.7347921,
              "endLng": -73.990752
            }
          ]
        }
      ]
    },
    {
      "eventName": "Pakistan Independence Day Parade & Festival",
      "eventDate": "2025-08-24",
      "closures": [
        {
          "type": "Formation",
          "streets": [
            {
              "startLocation": "Madison Avenue & 37th Street, New York, NY",
              "endLocation": "Madison Avenue & 38th Street, New York, NY",
              "startLat": 40.7496714,
              "startLng": -73.9815759,
              "endLat": 40.7502996,
              "endLng": -73.9811315
            }
          ]
        },
        {
          "type": "Route",
          "streets": [
            {
              "startLocation": "Madison Avenue & 38th Street, New York, NY",
              "endLocation": "Madison Avenue & 27th Street, New York, NY",
              "startLat": 40.7502996,
              "startLng": -73.9811315,
              "endLat": 40.7433803,
              "endLng": -73.9861384
            }
          ]
        },
        {
          "type": "Dispersal",
          "streets": [
            {
              "startLocation": "Madison Avenue & 27th Street, New York, NY",
              "endLocation": "Madison Avenue & 26th Street, New York, NY",
              "startLat": 40.7433803,
              "startLng": -73.9861384,
              "endLat": 40.7427776,
              "endLng": -73.9865801
            }
          ]
        },
        {
          "type": "Miscellaneous",
          "streets": [
            {
              "startLocation": "Madison Avenue & 24th Street, New York, NY",
              "endLocation": "Madison Avenue & 25th Street, New York, NY",
              "startLat": 40.7415312,
              "startLng": -73.9874845,
              "endLat": 40.7421611,
              "endLng": -73.9870293
            }
          ]
        },
        {
          "type": "Miscellaneous",
          "streets": [
            {
              "startLocation": "26th Street & Madison Avenue, New York, NY",
              "endLocation": "26th Street & Park Avenue South, New York, NY",
              "startLat": 40.7427776,
              "startLng": -73.9865801,
              "endLat": 40.7420717,
              "endLng": -73.98492329999999
            }
          ]
        }
      ]
    }
  ]
};

        // 1. Initialize the map
        const map = L.map('map').setView([40.758896, -73.985130], 14);

        // 2. Add a tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);

        // 3. Process the closures data and add polylines to the map
        closuresData.events.forEach(event => {
            event.closures.forEach(closure => {
                closure.streets.forEach(street => {
                    // Create the polyline using the start and end coordinates
                    const polyline = L.polyline([
                        [street.startLat, street.startLng],
                        [street.endLat, street.endLng]
                    ], {
                        color: '#ff4444',
                        weight: 6,
                        opacity: 0.9,
                        lineCap: 'round',
                        lineJoin: 'round',
                        dashArray: '10, 5'
                    }).addTo(map);

                    // Create the HTML content for the tooltip
                    const tooltipContent = `
                        <div style="font-weight: bold; margin-bottom: 4px;">${event.eventName}</div>
                        <div style="margin-bottom: 2px;"><strong>Date:</strong> ${event.eventDate}</div>
                        <div style="margin-bottom: 2px;"><strong>From:</strong> ${street.startLocation}</div>
                        <div style="margin-bottom: 2px;"><strong>To:</strong> ${street.endLocation}</div>
                    `;

                    polyline.bindTooltip(tooltipContent, {
                        permanent: false,
                        direction: 'top',
                        offset: [0, -10],
                        opacity: 1
                    });

                    // Add hover effects
                    polyline.on('mouseover', function(e) {
                        this.setStyle({
                            weight: 8,
                            opacity: 1,
                            color: '#ff2222'
                        });
                    });

                    polyline.on('mouseout', function(e) {
                        this.setStyle({
                            weight: 6,
                            opacity: 0.9,
                            color: '#ff4444'
                        });
                    });
                });
            });
        });

        // 4. Fit the map to show all closures
        if (closuresData.events.length > 0) {
            const bounds = L.latLngBounds();
            closuresData.events.forEach(event => {
                event.closures.forEach(closure => {
                    closure.streets.forEach(street => {
                        bounds.extend([street.startLat, street.startLng]);
                        bounds.extend([street.endLat, street.endLng]);
                    });
                });
            });
            map.fitBounds(bounds, { padding: [20, 20] });
        }

    </script>

</body>
</html>